<odoo>
    <data>

        <!-- Form -->
        <record id="view_action_products_form" model="ir.ui.view">
            <field name="name">Продукты</field>
            <field name="model">ozon.products</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <form>
                    <div name="button_box" position="inside">
                        <button class="oe_stat_button" type="object" name="history_price">
                            <field string="История цен" name="price_history_count" widget="statinfo" />
                        </button>
                        <button class="oe_stat_button" type="object" name="get_sales">
                            <field string="История продаж" name="get_sales_count" widget="statinfo" />
                        </button>
                        <button class="oe_stat_button" type="object" name="get_postings">
                            <field string="Отправления" name="postings_count"
                                widget="statinfo" />
                        </button>
                        <button class="oe_stat_button" type="object" name="get_supply_orders">
                            <field string="Поставки FBO" name="supply_orders_count"
                                widget="statinfo" />
                        </button>
                        <button class="oe_stat_button" type="object"
                            name="get_stocks">
                            <field string="История остатков" name="stock_history_count"
                                widget="statinfo" />
                        </button>
                    </div>
                    <group>
                        <field name="mass_pricing_ids"
                            attrs="{'invisible': [('mass_pricing_ids', '=', [])]}">
                            <tree limit="1">
                                <field name="price" />
                                <field name="new_price" />
                                <field name="status" />
                            </tree>
                        </field>
                    </group>

                    <field name="ozon_products_indicators_summary_ids"
                        readonly="1"
                        attrs="{'invisible': [('ozon_products_indicators_summary_ids', '=', [])]}"
                        create="0"
                    >
                        <kanban>
                            <field name="name" string="Индикаторы" />
                            <field name="type" />
                            <field name="color" />
                            <templates>
                                <t t-name="kanban-box">
                                    <div
                                        t-attf-class="{{'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) }} oe_kanban_card oe_kanban_global_click oe_semantic_html_override">
                                        <field name="name" />
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>

                    <field name="ozon_products_indicator_ids" invisible="1" />
                    <field name="retail_product_total_cost_price" invisible="1" />

                    <group>
                        <field name="calculated_pricing_strategy_ids">
                            <tree editable="bottom" edit="True">
                                <field name="strategy_id" invisible="1" />
                                <field name="expected_price" invisible="1" />
                                <field name="pricing_strategy_id" />
                                <field name="value" widget="percentage"
                                    attrs="{'invisible':[('strategy_id','=','expected_price')]}" />
                                <field name="weight" />
                                <field name="message" width="300px" />
                                <field name="timestamp" />
                            </tree>
                        </field>
                    </group>
                    <group>
                        <field name="product_calculator_ids">
                            <tree editable="bottom" edit="True">
                                <field name="name" />
                                <field name="value" />
                                <field name="new_value" />
                            </tree>
                        </field>
                    </group>
                    <div class="oe_right oe_button_box">
                        <group>
                            <field name="is_button_create_mass_pricing_shown" invisible="1" />
                            <button type="object" name="create_mass_pricing_without_dialog"
                                string="Применить рассчитанную цену"
                                class="btn-outline-primary"
                                attrs="{'invisible':[('is_button_create_mass_pricing_shown','=',False)]}"
                            />
                        </group>
                    </div>


                    <!-- Main info -->
                    <notebook>
                        <page id="page_lot_price_profit_main_info" string="Карточка товара">
                            <group>
                                <group>
                                    <group>
                                        <field name="products" />
                                        <field name="categories" string="Категория" />
                                        <field name="abc_group" string="Группа" />
                                        <field name="seller" />
                                    </group>
                                    <group>
                                        <field name="id_on_platform" />
                                        <field name="article" />
                                        <field name="sku" />
                                        <field name="fbo_sku" />
                                        <field name="fbs_sku" />
                                    </group>
                                </group>
                                <group>
                                    <group>
                                        <field name="marketing_price" />
                                        <field name="price" />
                                        <field name="old_price"
                                            style="text-decoration:line-through;" />
                                    </group>
                                    <group>
                                        <field name="trading_scheme" readonly="true" />
                                        <field name="stocks_fbo"
                                            attrs="{'invisible':[('trading_scheme','=','FBS')]}" />
                                        <field name="stocks_fbs"
                                            attrs="{'invisible':[('trading_scheme','=','FBO')]}" />
                                        <field name="is_selling" />
                                    </group>
                                </group>
                            </group>
                        </page>
                        <page id="page_price_comparison" string="Калькулятор">
                            <group>
                                <button type="object" name="calculate_price_comparison_ids"
                                    string="Рассчитать"
                                    class="btn-outline-primary"
                                />
                            </group>
                            <field name="price_comparison_ids">
                                <tree editable="1">
                                    <field name="name" />
                                    <field name="plan_value" />
                                    <field name="market_value" />
                                    <field name="fact_value" />
                                    <field name="diff_fact_market" />
                                    <field name="diff_plan_fact" />
                                    <field name="calc_value" />
                                    <field name="comment" optional="hide" />
                                </tree>
                            </field>
                        </page>
                        <page id="page_base_calculation" string="Плановая структура затрат">
                            <group>
                                <button type="object" name="reset_base_calculation_ids"
                                    string="Сбросить"
                                    class="btn-outline-primary"
                                />
                            </group>
                            <group>
                                <field name="base_calculation_ids">
                                    <tree editable="1">
                                        <field name="price_component_id" />
                                        <field name="kind" />
                                        <field name="value"
                                            attrs="{'readonly': [('kind','=','depends_on_volume')]}" />
                                        <field name="comment" optional="hide" />
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page id="page_price_calculator" string="Фактическая структура затрат">
                            <group>
                                <field name="expected_price" string="Цена" />
                            </group>

                            <field name="all_expenses_except_roi_roe_ids">
                                <tree>
                                    <field name="identifier" />
                                    <field name="name" />
                                    <field name="category" />
                                    <field name="kind" />
                                    <field name="comment" optional="hide" />
                                    <field name="percent" widget="percentage" />
                                    <field name="expected_value" sum="1" string="Значение" />
                                </tree>
                            </field>
                            <group>
                                <field name="calculator_delta" />
                            </group>
                            <field name="all_expenses_only_roi_roe_ids">
                                <tree>
                                    <field name="name" />
                                    <field name="comment" optional="hide" />
                                    <field name="percent" widget="percentage" />
                                    <field name="expected_value" string="Значение" />
                                </tree>
                            </field>
                        </page>
                        <!-- <page id="page_all_expenses_info" string="Ожидаемая структура затрат">
                            <group>
                                <field name="profitability_norm" />
                                <field name="investment_expenses_id" />
                            </group>
                            <group>
                                <field name="all_expenses_ids">
                                    <tree>
                                        <field name="name" />
                                        <field name="comment" optional="hide" />
                                        <field name="expected_value" />
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <group>
                                    <field name="expected_price" />
                                    <field name="expected_price_error"
                                        attrs="{'invisible': [('expected_price', '!=', 0)]}" />
                                </group>
                                <group>
                                    <field name="price_delta" />
                                </group>
                            </group>
                        </page> -->
                        <page id="page_lot_expenses_info" string="Комиссии и себестоимость">
                            <separator string="Фиксированные затраты" />
                            <notebook>
                                <page id="page_fbs_fix" string="FBS">
                                    <group>
                                        <group>
                                            <field name="fbs_fix_expenses_min">
                                                <tree>
                                                    <field name="name" />
                                                    <field name="price" />
                                                </tree>
                                            </field>
                                            <field name="total_fbs_fix_expenses_min" />
                                        </group>
                                        <group>
                                            <field name="fbs_fix_expenses_max">
                                                <tree>
                                                    <field name="name" />
                                                    <field name="price" />
                                                </tree>
                                            </field>
                                            <field name="total_fbs_fix_expenses_max" />
                                        </group>
                                    </group>
                                </page>
                                <page id="page_fbo_fix" string="FBO">
                                    <group>
                                        <group>
                                            <field name="fbo_fix_expenses_min">
                                                <tree>
                                                    <field name="name" />
                                                    <field name="price" />
                                                </tree>
                                            </field>
                                            <field name="total_fbo_fix_expenses_min" />
                                        </group>
                                        <group>
                                            <field name="fbo_fix_expenses_max">
                                                <tree>
                                                    <field name="name" />
                                                    <field name="price" />
                                                </tree>
                                            </field>
                                            <field name="total_fbo_fix_expenses_max" />
                                        </group>
                                    </group>
                                </page>
                            </notebook>

                            <separator string="Процентные затраты" />
                            <notebook>
                                <page id="page_fbs_percent" string="FBS">
                                    <group>
                                        <field name="fbs_percent_expenses">
                                            <tree>
                                                <field name="name" />
                                                <field name="discription" />
                                                <field name="price" />
                                            </tree>
                                        </field>
                                        <field name="total_fbs_percent_expenses" />
                                    </group>
                                </page>
                                <page id="page_fbo_percent" string="FBO">
                                    <group>
                                        <field name="fbo_percent_expenses">
                                            <tree>
                                                <field name="name" />
                                                <field name="discription" />
                                                <field name="price" />
                                            </tree>
                                        </field>
                                        <field name="total_fbo_percent_expenses" />
                                    </group>
                                </page>
                            </notebook>
                        </page>
                        <page id="page_lot_description_info" string="Описание">
                            <group>
                                <field name="categories" />
                                <field name="supplementary_categories">
                                    <tree>
                                        <field name="name" />
                                    </tree>
                                </field>
                            </group>

                            <group>
                                <field name="description" />
                            </group>
                            <group>
                                <field name="search_queries" widget="many2many_tags" />
                            </group>
                            <group string="Изображения">
                                <field name="imgs_html" string="Изображения" />
                            </group>
                        </page>
                        <page id="page_lot_promotion_info" string="Продвижение">
                            <group style="margin-bottom: 20px;">
                                <field name="marketing_discount" widget="percentage" />
                            </group>
                            <group>
                                <field name="category_marketing_discount" widget="percentage" />
                            </group>
                            <small>Данная скидка будет применена для расчёта "Вашей цены" в
                                столбце "Рынок" на вкладке "Калькулятор"</small>
                            <separator string="Поисковые запросы" />
                            <field name="tracked_search_query_ids">
                                <tree>
                                    <field name="name" />
                                </tree>
                            </field>
                            <separator string="Затраты на продвижение" />
                            <field name="promotion_expenses_ids">
                                <tree>
                                    <field name="date" />
                                    <field name="promotion_type" />
                                    <field name="qty" />
                                    <field name="percent_rate" />
                                    <field name="expense" />
                                </tree>
                            </field>
                        </page>
                        <page id="page_lot_competitors_info" string="Конкуренты">
                            <separator string="Конкуренты" />
                            <field name="competitors_with_price_ids" widget="one2many_list">
                                <tree limit="10">
                                    <field name="product_competitors" />
                                    <field name="price_with_card" />
                                    <field name="price" />
                                    <field name="price_without_sale" />
                                    <field name="last_update" />
                                </tree>
                            </field>
                            <group>
                                <field name="not_enough_competitors"
                                    string="Конкурентов меньше трёх" />
                                <field name="commentary_not_enough_competitors" string="Комментарий"
                                    attrs="{'invisible': [('not_enough_competitors', '=', False)]}"
                                    placeholder="Подтвердите письменно, что конкурентов недостаточно"
                                />
                            </group>
                        </page>
                        <page id="page_analysis_data" string="Аналитические данные">
                            <notebook>
                                <page id="page_analysis_data_plots" string="Графики">
                                    <group>
                                        <field name="img_html_sale_this_year"
                                            string="График продаж за текущий год" />
                                        <field name="img_data_sale_this_year" invisible="1" />
                                        <field name="img_data_sale_last_year" invisible="1" />
                                        <field name="img_data_sale_two_weeks" invisible="1" />
                                        <field name="img_data_sale_six_weeks" invisible="1" />
                                        <field name="img_data_sale_twelve_weeks" invisible="1" />
                                        <field name="img_data_stock" invisible="1" />
                                        <field name="img_data_analysis_data" invisible="1" />
                                    </group>
                                    <button string="Скачать данные"
                                        type="object"
                                        class="oe_highlight"
                                        icon="fa-download"
                                        name="download_img_data_sale_this_year"
                                        attrs="{'invisible': [('img_data_sale_this_year', '=', False)]}"
                                    />

                                    <group>
                                        <field name="img_html_sale_last_year"
                                            string="График продаж за прошлый год" />
                                    </group>
                                    <button string="Скачать данные"
                                        type="object"
                                        class="oe_highlight"
                                        icon="fa-download"
                                        name="download_img_data_sale_last_year"
                                        attrs="{'invisible': [('img_data_sale_last_year', '=', False)]}"
                                    />

                                    <group>
                                        <field name="img_html_price_history"
                                            string="График истории цен" />
                                    </group>
                                    <!--                                        <button string="Скачать данные"-->
                                    <!--                                            type="object"-->
                                    <!--                                            class="oe_highlight"-->
                                    <!--                                            icon="fa-download"-->
                                    <!--                                            name="download_img_data_price_history"-->
                                    <!--                                            attrs="{'invisible': [('img_data_price_history', '=',
                                    False)]}"-->
                                    <!--                                        />-->

                                    <group>
                                        <field name="img_html_sale_two_weeks"
                                            string="График продаж за 2 последних недели" />
                                    </group>
                                    <button string="Скачать данные"
                                        type="object"
                                        class="oe_highlight"
                                        icon="fa-download"
                                        name="download_img_data_sale_two_weeks"
                                        attrs="{'invisible': [('img_data_sale_two_weeks', '=', False)]}"
                                    />


                                    <group>
                                        <field name="img_html_sale_six_weeks"
                                            string="График продаж за 6 последних недели" />
                                    </group>
                                    <button string="Скачать данные"
                                        type="object"
                                        class="oe_highlight"
                                        icon="fa-download"
                                        name="download_img_data_sale_six_weeks"
                                        attrs="{'invisible': [('img_data_sale_six_weeks', '=', False)]}"
                                    />


                                    <group>
                                        <field name="img_html_sale_twelve_weeks"
                                            string="График продаж за 12 последних недели" />
                                    </group>
                                    <button string="Скачать данные"
                                        type="object"
                                        class="oe_highlight"
                                        icon="fa-download"
                                        name="download_img_data_sale_twelve_weeks"
                                        attrs="{'invisible': [('img_data_sale_twelve_weeks', '=', False)]}"
                                    />

                                    <group>
                                        <field name="img_html_stock"
                                            string="График остатков за текущий год" />
                                    </group>
                                    <button string="Скачать данные"
                                        type="object"
                                        class="oe_highlight"
                                        icon="fa-download"
                                        name="download_img_data_stock"
                                        attrs="{'invisible': [('img_data_stock', '=', False)]}"
                                    />

                                    <group>
                                        <field name="img_html_analysis_data"
                                            string="График интереса за текущий год" />
                                    </group>
                                    <button string="Скачать данные"
                                        type="object"
                                        class="oe_highlight"
                                        icon="fa-download"
                                        name="download_img_data_analysis_data"
                                        attrs="{'invisible': [('img_data_analysis_data', '=', False)]}"
                                    />
                                </page>
                                <page id="page_analysis_data_abc_analysis" string="ABC анализ">
                                    <group>
                                        <field name="revenue_share_temp"
                                            string="Доля продукта в выручке, %"
                                            readonly="1" />
                                        <field name="revenue_cumulative_share_temp"
                                            string="Накопительный вклад, %"
                                            readonly="1" />
                                        <field name="abc_group" string="Группа" />
                                    </group>
                                </page>
                                <page id="page_analysis_data_price_index" string="Ценовой индекс">
                                    <group string="Ценовой индекс и цены конкурентов">
                                        <field name="price_index" />
                                        <field name="ozon_comp_min_price" />
                                        <field name="ext_comp_min_price" />
                                        <field name="self_marketplaces_min_price" />
                                    </group>
                                </page>
                                <page id="page_analysis_data_abc_analysis" string="BCG Матрица">
                                    <group>
                                        <field name="bcg_group_is_computed" invisible="1" />
                                        <field name="bcg_group"
                                            string="BCG группа"
                                            readonly="0"
                                            attrs="{'invisible': [('bcg_group_is_computed', '=', False)]}"
                                        />
                                    </group>
                                </page>
                            </notebook>
                        </page>
                        <page id="page_ozon_actions" string="Акции">
                            <group>
                                <field name="action_candidate_ids">
                                    <tree>
                                        <field name="action_id" />
                                        <field name="action_start" />
                                        <field name="action_end" />
                                        <field name="action_status" widget="badge"
                                            decoration-success="action_status=='started'"
                                            decoration-muted="action_status=='not_started'"
                                            decoration-info="action_status=='ended'" />
                                        <field name="max_action_price" />
                                        <field name="is_participating" />
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="Выручка и расходы за период">
                            <group>
                                <group>
                                    <button string="Рассчитать"
                                            type="object"
                                            name="action_calculate_revenue_returns_promotion_for_period"
                                            attrs="{'invisible': [('period_start', '=', False)]}"
                                    />
                                </group>
                                <group></group>
                                <group>
                                    <field name="period_preset" class="oe_inline" string="Пресеты периода"/>
                                </group>
                                <group></group>
                                <group>
                                    <field name="period_start" widget="daterange" class="oe_inline"
                                           options="{'related_end_date': 'period_finish'}"
                                           string="Период"
                                    />
                                </group>
                                <field name="ozon_report_products_revenue_expenses_ids">
                                    <tree create="0">
                                        <field name="identifier"/>
                                        <field name="name"/>
                                        <field name="comment" optional="hide"/>
                                        <field name="qty"/>
                                        <field name="percent"/>
                                        <field name="value" sum="1"/>
                                        <field name="percent_from_total"/>
                                        <field name="total_value" sum="1"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <!-- Tree -->
        <record id="view_action_products_tree" model="ir.ui.view">
            <field name="name">Продукты</field>
            <field name="model">ozon.products</field>
            <field name="arch" type="xml">
                <tree default_order="ozon_products_indicator_qty desc, abc_group">
                    <field name="retail_product_total_cost_price" invisible="1" />
                    <field name="article" />
                    <field name="products" />
                    <field name="price" />
                    <field name="is_selling" />
                    <field name="trading_scheme" />
                    <field name="abc_group" string="ABC Группа"
                        decoration-success="abc_group=='A'"
                        decoration-danger="abc_group=='C'"
                    />
                    <field name="ozon_products_indicator_qty"
                        decoration-danger="ozon_products_indicator_qty>0"
                        attrs="{'invisible': [('ozon_products_indicator_qty', '=', 0)]}"
                        string="Индикаторы"
                    />
                </tree>
            </field>
        </record>

        <!-- Kanban -->
        <record id="view_product_kanban_custom" model="ir.ui.view">
            <field name="name">Лоты</field>
            <field name="model">ozon.products</field>
            <field name="arch" type="xml">
                <kanban>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_content">
                                <div class="oe_kanban_global_click">
                                    <div class="oe_kanban_details">
                                        <field name="img_html" />
                                    </div>
                                </div>

                                <div style="display: block;"> Артикул: <field name="article" />
                                </div>
                                <div style="display: block;">
                                    <field name="products" />
                                </div>

                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Search form -->
        <record id="view_ozon_products_search" model="ir.ui.view">
            <field name="name">Лоты</field>
            <field name="model">ozon.products</field>
            <field name="arch" type="xml">
                <search>
                    <field name="article" />
                    <field name="categories" />
                    <filter name="ozon_caetgory" string="Category"
                        context="{'group_by':'categories'}" />
                    <searchpanel>
                        <field name="categories" />
                    </searchpanel>
                </search>
            </field>
        </record>

        <!-- Actions -->
        <record model="ir.actions.act_window" id="action_products">
            <field name="name">Продукты</field>
            <field name="res_model">ozon.products</field>
            <field name="view_mode">kanban,tree,form,search</field>
        </record>


        <record model="ir.actions.server" id="action_draw_plot_products">
            <field name="name">Рассчитать "Аналитические данные"</field>
            <field name="model_id" ref="model_ozon_products" />
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="state">code</field>
            <field name="code">
                records.action_draw_graphs()
            </field>
        </record>

        <record model="ir.actions.server" id="action_run_indicators_checks">
            <field name="name">Обновить индикаторы</field>
            <field name="model_id" ref="model_ozon_products" />
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="state">code</field>
            <field name="code">
                records.action_run_indicators_checks()
            </field>
        </record>

        <!-- Action to call profitability_norm wizard. This action calls wizard model form view -->
        <record id="wizard_action_profitability_norm" model="ir.actions.act_window">
            <field name="name">Назначить ожидаемую доходность</field>
            <field name="type">ir.actions.act_window</field>
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="res_model">ozon.profitability_norm.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="wizard_view_profitability_norm_form" />
            <field name="target">new</field>
        </record>

        <!-- Action to call investment_expenses wizard. This action calls wizard model form view -->
        <record id="wizard_action_investment_expenses" model="ir.actions.act_window">
            <field name="name">Назначить investment</field>
            <field name="type">ir.actions.act_window</field>
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="res_model">ozon.investment_expenses.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="wizard_view_investment_expenses_form" />
            <field name="target">new</field>
        </record>

        <record id="wizard_action_assign_strategies" model="ir.actions.act_window">
            <field name="name">Назначить стратегии</field>
            <field name="type">ir.actions.act_window</field>
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="res_model">ozon.products_mass_pricing.wizard</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="products_mass_pricing_wizard_form" />
            <field name="target">new</field>
        </record>

        <record model="ir.actions.server" id="action_base_calculation_wizard">
            <field name="name">Назначить плановый расчёт</field>
            <field name="model_id" ref="model_ozon_products" />
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="state">code</field>
            <field name="code">
                action = records.open_base_calculation_wizard()
            </field>
        </record>

        <!-- Menu -->
        <menuitem name="Продукты"
            id="menu_products"
            parent="main_menu_products"
            action="action_products"
            sequence="20" />

    </data>
</odoo>