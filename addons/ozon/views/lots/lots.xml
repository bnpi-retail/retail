<odoo>
    <data>

        <!-- Form -->
        <record id="view_action_products_form" model="ir.ui.view">
            <field name="name">Лоты</field>
            <field name="model">ozon.products</field>
            <field name="arch" type="xml">
                <form>

                    <div name="button_box" position="inside">
                        <button class="oe_stat_button" type="object" name="history_price">
                            <field string="История цен" name="price_history_count" widget="statinfo" />
                        </button>
                        <button class="oe_stat_button" type="object" name="get_sales">
                            <field string="История продаж" name="get_sales_count" widget="statinfo" />
                        </button>
                    </div>

                    <!-- Main info -->
                    <group>
                        <field name="is_selling" />
                        <field name="is_alive" />
                        <field name="id_on_platform" />
                        <field name="categories" />
                        <field name="supplementary_categories">
                            <tree>
                                <field name="name" />
                            </tree>
                        </field>
                        <field name="products" />
                        <field name="old_price" style="text-decoration:line-through;" />
                        <field name="price" />
                        <field name="seller" />
                        <field name="index_localization" />
                        <field name="trading_scheme" />
                        <field name="delivery_location" />
                        <field name="insurance" />
                        <field name="search_queries" widget="many2many_tags" />
                        <field name="stocks_fbs" />
                        <field name="stocks_fbo" />
                    </group>


                    <separator string="Фиксированные затраты" />
                    <notebook>
                        <page id="page_fbs_fix" string="FBS">
                            <group>
                                <group>
                                    <field name="fbs_fix_expenses_min">
                                        <tree>
                                            <field name="name" />
                                            <field name="price" />
                                        </tree>
                                    </field>
                                    <field name="total_fbs_fix_expenses_min" />
                                </group>
                                <group>
                                    <field name="fbs_fix_expenses_max">
                                        <tree>
                                            <field name="name" />
                                            <field name="price" />
                                        </tree>
                                    </field>
                                    <field name="total_fbs_fix_expenses_max" />
                                </group>
                            </group>
                        </page>
                        <page id="page_fbo_fix" string="FBO">
                            <group>
                                <group>
                                    <field name="fbo_fix_expenses_min">
                                        <tree>
                                            <field name="name" />
                                            <field name="price" />
                                        </tree>
                                    </field>
                                    <field name="total_fbo_fix_expenses_min" />
                                </group>
                                <group>
                                    <field name="fbo_fix_expenses_max">
                                        <tree>
                                            <field name="name" />
                                            <field name="price" />
                                        </tree>
                                    </field>
                                    <field name="total_fbo_fix_expenses_max" />
                                </group>
                            </group>
                        </page>
                    </notebook>

                    <separator string="Процентные затраты" />
                    <notebook>
                        <page id="page_fbs_percent" string="FBS">
                            <group>
                                <field name="fbs_percent_expenses">
                                    <tree>
                                        <field name="name" />
                                        <field name="discription" />
                                        <field name="price" />
                                    </tree>
                                </field>
                                <field name="total_fbs_percent_expenses" />
                            </group>
                        </page>
                        <page id="page_fbo_percent" string="FBO">
                            <group>
                                <field name="fbo_percent_expenses">
                                    <tree>
                                        <field name="name" />
                                        <field name="discription" />
                                        <field name="price" />
                                    </tree>
                                </field>
                                <field name="total_fbo_percent_expenses" />
                            </group>
                        </page>
                    </notebook>

                    <group>
                        <separator string="Прибыль" />
                        <field name="profit" />
                        <field name="profit_ideal" />
                        <field name="profit_delta" />
                        <field name="profitability_norm" />

                        <separator string="История цен конкурентов" />
                        <field name="price_history_ids" widget="one2many_list">
                            <tree limit="10">
                                <field name="timestamp" />
                                <field name="product_competitors" />
                                <field name="price" />
                            </tree>
                        </field>

                        <separator string='Коэффициенты' />
                        <field name="sales_per_day_last_30_days" />
                        <field name="sales_per_day_last_30_days_group" />
                        <field name="coef_profitability" widget="percentage"
                            style="max-width: 58px;" />
                        <field name="coef_profitability_group" />

                    </group>

                    <!-- GPT Отслеживаемые позиции -->
                    <group string="Отслеживаемые поисковые запросы по описанию">
                        <field name="description" />
                    </group>
                    <field name="tracked_search_queries" widget="one2many_list">
                        <tree>
                            <field name="name" />
                        </tree>
                    </field>

                    <!-- <div>
                        <field name="plotly_chart" widget="plotly_chart"/>
                    </div> -->

                </form>
            </field>
        </record>

        <!-- Tree -->
        <record id="view_action_products_tree" model="ir.ui.view">
            <field name="name">Лоты</field>
            <field name="model">ozon.products</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="products" />
                    <field name="price" />
                    <field name="is_selling" />
                    <field name="is_alive" />
                    <field name="trading_scheme" />
                    <field name="stocks_fbs" />
                    <field name="stocks_fbo" />
                </tree>
            </field>
        </record>

        <!-- Actions -->
        <record model="ir.actions.act_window" id="action_products">
            <field name="name">Лоты</field>
            <field name="res_model">ozon.products</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.server" id="action_add_product_to_mass_pricing_queue">
            <field name="name">Добавить в очередь изменения цен</field>
            <field name="model_id" ref="model_ozon_products" />
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="binding_view_types">form</field>
            <field name="state">code</field>
            <field name="code">
                action = records.create_mass_pricing()
            </field>
        </record>

        <!-- <record model="ir.actions.act_window" id="action_products_create_mass_pricing_">
            <field name="name">Добавить в очередь на изменение цен</field>
            <field name="res_model">ozon.mass_pricing</field>
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="binding_view_types">form</field>
            <field name="target">new</field>
            <field name="view_mode">form</field>
            <field name="context">{
                "default_product": active_id,
                }</field>
        </record> -->

        <!-- Action to call profitability_norm wizard. This action calls wizard model form view -->
        <record id="wizard_action_profitability_norm" model="ir.actions.act_window">
            <field name="name">Назначить норму прибыльности</field>
            <field name="type">ir.actions.act_window</field>
            <field name="binding_model_id" ref="model_ozon_products" />
            <field name="res_model">ozon.profitability_norm.wizard</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="wizard_view_profitability_norm_form" />
            <field name="target">new</field>
        </record>

        <!-- Menu -->
        <menuitem name="Лоты"
            id="menu_products"
            parent="main_menu_products"
            action="action_products"
            sequence="20" />

    </data>
</odoo>